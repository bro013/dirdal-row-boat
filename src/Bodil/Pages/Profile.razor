@page "/profile"

@using Bodil.Models
@using Bodil.Services

@inject IUserDataService UserService
@inject ISnackbar Snackbar

<PageTitle>Profil</PageTitle>


<MudGrid Justify="Justify.Center">
    <MudItem md=6 xs="12">
        <MudCard>
            <MudCardContent>
                <MudGrid>
                    <MudItem xs="12">
                        <MudTextField T="string" @bind-Value=user.FirstName Required=true RequiredError="Mangler fornavn"
                                      Label="Fornavn" Immediate=true></MudTextField>
                    </MudItem>
                    <MudItem xs="12">
                        <MudTextField T="string" @bind-Value=user.LastName Required=true RequiredError="Mangler etternavn"
                                      Label="Etternavn" Immediate=true></MudTextField>
                    </MudItem>
                    <MudItem xs="12">
                        <MudTextField T="string" @bind-Value=user.Email Required=true RequiredError="Mangler epost"
                                      Label="Epost" InputMode="InputMode.email" Immediate=true></MudTextField>
                    </MudItem>
                    <MudItem xs="12">
                        <MudTextField T="string" @bind-Value=user.PhoneNumber Required=true RequiredError="Mangler telefonnummer"
                                      Label="Telefonnummer" Immediate=true></MudTextField>
                    </MudItem>
                </MudGrid>
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem md="6" xs="12" Class="d-flex justify-center">
        <MudColorPicker @bind-Text=user.Color DisableAlpha=true DisableColorField=false
                        DisablePreview=false DisableToolbar=false DisableInputs=true
                        ColorPickerMode="ColorPickerMode.RGB" PickerVariant="PickerVariant.Static" />
    </MudItem>
    <MudItem xs="12">
        <MudButton ButtonType="ButtonType.Button" Color="Color.Primary" Variant="Variant.Filled" OnClick="UpdateUserAsync">Oppdater</MudButton>
    </MudItem>

</MudGrid>

@code {

    User user = new();

    protected override async Task OnInitializedAsync()
    {
        var userId = Guid.Parse("fe108034-9d68-4673-9d6b-c89ebc94a7d0");
        user = await UserService.GetUserAsync(userId);
    }

    async Task UpdateUserAsync()
    {
        await UserService.UpdateUserAsync(user);
        Snackbar.Add("Profilen din har blitt oppdatert", Severity.Success);
    }
}
