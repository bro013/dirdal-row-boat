@page "/schedule"

<PageTitle>Schedule </PageTitle>

@using BlazorScheduler
@using DirdalRowBoat.Database
@using DirdalRowBoat.Database.Models
@using DirdalRowBoat.Services

@inject ReservationService ReservationService

<Scheduler OnAddingNewAppointment="OnAddingNewAppointment" OnRequestNewData="OnRequestNewData">
    <Appointments>
        @foreach (var reservation in _reservations)
        {
            <Appointment Start="@reservation.Start" End="@reservation.End" Color="@reservation.Color">
                @reservation.Title
            </Appointment>
        }
    </Appointments>
</Scheduler>

@code {
    List<Reservation> _reservations = new() { new Reservation() { Title = "Test", Start = DateTime.UtcNow, End = DateTime.Today.AddDays(1), Color = "aqua" } };

    Guid userId;

    protected override void OnInitialized()
    {
        userId = Guid.NewGuid();
    }

    async Task OnAddingNewAppointment(DateTime start, DateTime end)
    {
        var reservation = new Reservation()
            {
                UserId = userId,
                Title = "Ny reservering",
                Start = start,
                End = end,
                Color = "aqua"
            };
        await ReservationService.AddReservationAsync(reservation);
        _reservations.Add(reservation);
    }

    async Task OnRequestNewData(DateTime start, DateTime end)
    {
        _reservations = await ReservationService.GetReservationsAsync(start, end);
    }

}
